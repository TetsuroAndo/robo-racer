# FTG 壁接近時停止 調査・修正ステート

## 概要

- 事象: 直進/旋回は可能だが、壁接近時に停止し、その場で復帰しづらい
- 対象: `rpi/src/Process.cpp`, `rpi/src/config/Config.h`
- 作成日: 2026-02-07

## ステート

| 項目 | 状態 | 更新日 | メモ |
| --- | --- | --- | --- |
| 関連資料確認 (`docs/planning/ftg_v1.md` / `ftg_gap_steer_refactor_*`) | 完了 | 2026-02-07 | 側壁/正面付近の誤停止は既知系統 |
| 既存実装確認 (`Process.cpp`) | 完了 | 2026-02-07 | `blocked = (path_clearance <= NEAR)` が停止トリガ |
| 根因仮説の整理 | 完了 | 2026-02-07 | 「指令舵では回避可能でも最小クリアランスで停止」「no-gap時に舵0復帰」が復帰阻害要因 |
| 修正方針の確定 | 完了 | 2026-02-07 | 回避方向が十分クリアな場合の停止誤爆緩和 + no-gap舵フォールバック改善 |
| 実装 | 完了 | 2026-02-07 | `path_clearance`=指令舵側、`found_gap`時は舵維持 |
| ビルド確認 | 未着手 | - | `make rpi` 予定 |
| 実機確認 | 未着手 | - | `path_obst_mm`, `front_dist_mm`, `override_kind` 確認 |

## 修正方針（実装前）

1. 円弧クリアランスを「現在舵」「指令舵」で分離保持する。
2. 現在舵が危険でも、**指令舵側に十分なクリアランスがある場合**は即停止せず低速で復帰可能にする。
3. `found_gap == false` 時に舵を即0へ戻す挙動を見直し、進行可能方向を維持してスタックを避ける。
