# TSD20+IMU 予測マージンシステム実装ステート

## 目的
- TSD20距離とIMUの加速度/速度から衝突予測を行い、状況に応じたマージンを設定する。
- 予測は「遅延中の移動距離（d_travel）」のみ距離側に反映し、停止距離はv_max側に残す。

## 前提
- IMUが無効/未校正の場合は安全側のフォールバックを使う。
- 既存のTSD20クランプは維持しつつ、予測マージンを追加する。

## ステート

| 項目 | 状態 | 更新日 | メモ |
| --- | --- | --- | --- |
| 影響範囲の確認 | 完了 | 2026-02-05 | main.cpp/Config.h/ログを確認 |
| 予測マージンの設計 | 完了 | 2026-02-05 | d_travelのみ距離側へ反映 |
| Config定数の追加 | 完了 | 2026-02-05 | 予測上限/加速度上限を追加 |
| ブレーキ下限の調整 | 完了 | 2026-02-05 | IMU_BRAKE_MIN/INIT を引き上げ |
| ログの拡張 | 完了 | 2026-02-05 | margin_pred/d_travel/v_used を出力 |
| 未校正フォールバック | 完了 | 2026-02-05 | 未校正用のブレーキ定数でa_capを保守化 |
| ビルド/テスト | 未実施 | 2026-02-05 | 実機で検証 |
